{"version":3,"file":"_server-O9yxweRf.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/upload/_server.js"],"sourcesContent":["import { simpleParser } from \"mailparser\";\nconst POST = async ({ request }) => {\n  try {\n    const formData = await request.formData();\n    const emlFile = formData.get(\"emlFile\");\n    if (!emlFile) {\n      return new Response(JSON.stringify({ error: \"업로드된 파일이 없습니다\" }), {\n        status: 400,\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Access-Control-Allow-Origin\": \"*\"\n          // 모든 출처 허용\n        }\n      });\n    }\n    const arrayBuffer = await emlFile.arrayBuffer();\n    const emlBuffer = Buffer.from(arrayBuffer);\n    const parsedEmail = await simpleParser(emlBuffer);\n    const formatAttachment = (attachment) => {\n      return {\n        filename: attachment.filename,\n        contentType: attachment.contentType,\n        size: attachment.size,\n        content: attachment.content.toString(\"base64\")\n        // 파일 다운로드를 위해 base64로 인코딩\n      };\n    };\n    const formatPart = (part) => {\n      let formattedPart = {\n        contentType: part.contentType,\n        content: part.text || part.html\n      };\n      if (part.childNodes && part.childNodes.length > 0) {\n        formattedPart.childNodes = part.childNodes.map(formatPart);\n      }\n      return formattedPart;\n    };\n    const formattedEmail = {\n      subject: parsedEmail.subject || \"제목 없음\",\n      from: parsedEmail.from?.text || \"알 수 없는 발신자\",\n      to: parsedEmail.to?.text || \"알 수 없는 수신자\",\n      cc: parsedEmail.cc?.text || \"\",\n      bcc: parsedEmail.bcc?.text || \"\",\n      date: parsedEmail.date?.toISOString() || \"\",\n      text: parsedEmail.text || \"본문 내용 없음\",\n      html: parsedEmail.html || \"\",\n      attachments: parsedEmail.attachments?.map(formatAttachment) || [],\n      headers: parsedEmail.headers,\n      messageId: parsedEmail.messageId,\n      inReplyTo: parsedEmail.inReplyTo,\n      references: parsedEmail.references\n    };\n    if (parsedEmail.html) {\n      formattedEmail.content = parsedEmail.html;\n      formattedEmail.contentType = \"html\";\n    } else if (parsedEmail.textAsHtml) {\n      formattedEmail.content = parsedEmail.textAsHtml;\n      formattedEmail.contentType = \"html\";\n    } else if (parsedEmail.text) {\n      formattedEmail.content = parsedEmail.text;\n      formattedEmail.contentType = \"text\";\n    } else {\n      formattedEmail.content = \"본문 내용 없음\";\n      formattedEmail.contentType = \"text\";\n    }\n    if (parsedEmail.parts && parsedEmail.parts.length > 0) {\n      formattedEmail.parts = parsedEmail.parts.map(formatPart);\n    }\n    return new Response(JSON.stringify(formattedEmail), {\n      status: 200,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Access-Control-Allow-Origin\": \"*\",\n        // CORS 허용\n        \"Access-Control-Allow-Methods\": \"POST, GET, OPTIONS\",\n        \"Access-Control-Allow-Headers\": \"Content-Type\"\n      }\n    });\n  } catch (error) {\n    console.error(\"이메일 파싱 중 오류 발생:\", error);\n    return new Response(JSON.stringify({ error: \"이메일 파싱 중 오류가 발생했습니다\" }), {\n      status: 500,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Access-Control-Allow-Origin\": \"*\"\n        // CORS 허용\n      }\n    });\n  }\n};\nconst OPTIONS = async () => {\n  return new Response(null, {\n    status: 204,\n    headers: {\n      \"Access-Control-Allow-Origin\": \"*\",\n      // 모든 출처 허용\n      \"Access-Control-Allow-Methods\": \"POST, GET, OPTIONS\",\n      // 허용할 메서드\n      \"Access-Control-Allow-Headers\": \"Content-Type\"\n      // 허용할 헤더\n    }\n  });\n};\nexport {\n  OPTIONS,\n  POST\n};\n"],"names":[],"mappings":"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"}